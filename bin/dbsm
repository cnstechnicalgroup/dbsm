#!/usr/bin/env perl6

use v6;
use DBSM;

# Constants
my $config_dir = $*HOME ~ "/.dbsm";
my $config_file = $config_dir ~ "/config";

my $dbsm = DBSM.new(dir => $config_dir, file => $config_file);

multi MAIN( 'init', Str $project_name, Str $environment, Str $db_type, :$generate?, :$pw_len? ) {
  $dbsm.init( $project_name, $environment, $db_type, :$generate, :$pw_len );
}

multi MAIN('project', 'list') {
  my @project_list =  $dbsm.project_list();
  for @project_list { .say } 
}

multi MAIN('project', 'echovars', Str $project_name, Str $environment, $echopass?) {
  say $dbsm.project_echovars($project_name, $environment, $echopass);
}

multi MAIN('script', 'add', Str $project_name, Str $script_name;) {
  say $dbsm.script_add($project_name, $script_name);
}

multi MAIN('script', 'run', Str $project_name, Str $environment, Str $script_name) {
  $dbsm.script_run($project_name, $environment, $script_name);
}

multi MAIN('script', 'list', Str $project_name) {
  my @script_list = $dbsm.script_list($project_name);
  for @script_list.sort { .split('/').tail.Str.say }
}

multi MAIN('git', 'init') {
  say $dbsm.git_init();
}

multi MAIN('git', 'remote', 'origin', Str $url) {
  say $dbsm.git_remote_origin($url);
}

multi MAIN('git', 'push') {
  $dbsm.git_push();
}

multi MAIN('git', 'pull') {
  $dbsm.git_pull();
}
